import i from"fs";import n from"fast-glob";import*as m from"csso";import*as l from"html-minifier-terser";import{minify as u}from"terser";const r=async(a,o)=>{const e=await n(a);for(const s of e)try{await i.promises.writeFile(s,await o(await i.promises.readFile(s,"utf-8")),"utf-8")}catch{console.log("Error: Cannot minify file "+s+"!")}};function f(a={}){var s;const e=Object.assign({path:"./dist/",css:{clone:!1,comments:!1,debug:!1,forceMediaMerge:!0,restructure:!0,sourceMap:!1},html:{caseSensitive:!0,collapseBooleanAttributes:!0,collapseInlineTagWhitespace:!1,collapseWhitespace:!0,conservativeCollapse:!1,continueOnParseError:!1,customAttrAssign:[],customAttrCollapse:"",customAttrSurround:[],customEventAttributes:[/^on[a-z]{3,}$/],decodeEntities:!1,html5:!0,ignoreCustomComments:[],ignoreCustomFragments:[],includeAutoGeneratedTags:!0,keepClosingSlash:!0,maxLineLength:null,minifyCSS:!0,minifyJS:!0,minifyURLs:!1,preserveLineBreaks:!1,preventAttributesEscaping:!1,processConditionalComments:!0,processScripts:["module"],quoteCharacter:"",removeAttributeQuotes:!0,removeComments:!0,removeEmptyAttributes:!0,removeEmptyElements:!1,removeOptionalTags:!1,removeRedundantAttributes:!0,removeScriptTypeAttributes:!0,removeStyleLinkTypeAttributes:!0,removeTagWhitespace:!0,sortAttributes:!0,sortClassName:!0,trimCustomFragments:!1,useShortDoctype:!0},js:{ecma:5,enclose:!1,keep_classnames:!1,keep_fnames:!1,ie8:!1,module:!1,safari10:!1,toplevel:!1}},a);return e.path=(s=e.path)!=null&&s.endsWith("/")?e.path:`${e.path}/`,{name:"astro-compress",hooks:{"astro:build:done":async()=>{e.css&&await r(`${e.path}**/*.css`,t=>m.minify(t,e.css).css),e.html&&await r(`${e.path}**/*.html`,async t=>await l.minify(t,e.html)),e.js&&await r(`${e.path}**/*.{js,mjs,cjs}`,async t=>(await u(t,e.js)).code),e.img&&await r(`${e.path}**/*.{png,jpeg,jpg,gif,ico}`,async t=>{})}}}}export{f as default};
