var M=(...[r={}])=>{Object.entries(r).forEach(([e,a])=>Object.defineProperty(r,e,{value:a===!0?l[e]:r[e]}));const{Path:o,Cache:s,Logger:d,Map:m,Exclude:u,Action:y,CSS:w,HTML:g,Image:h,JavaScript:T,SVG:j}=c(l,r),p=new Set;return typeof o<"u"&&(Array.isArray(o)||o instanceof Set)&&o.forEach(e=>p.add(e)),{name:"astro-compress",hooks:{"astro:build:done":async({dir:e})=>{if(typeof m=="object"){p.size||p.add(e),typeof s=="object"&&s.Search===A&&(s.Search=e);for(const[a,i]of Object.entries({CSS:w,HTML:g,Image:h,JavaScript:T,SVG:j})){if(!(i&&m[a]))return;f=c(y,c(y,{Wrote:async({Buffer:t,Input:n})=>{switch(a){case"CSS":return(await import("csso")).minify(t.toString(),i).css;case"HTML":return await(await import("html-minifier-terser")).minify(t.toString(),i);case"JavaScript":return(await(await import("terser")).minify(t.toString(),i)).code??t;case"Image":return(await import("../Function/Image.js")).default(i,{Buffer:t,Input:n});case"SVG":{const{data:I}=(await import("svgo")).optimize(t.toString(),i);return I??t}default:return t}},Fulfilled:async t=>t.Files>0?`Successfully compressed a total of ${t.Files} ${a} ${t.Files===1?"file":"files"} for ${await(await import("files-pipe/Target/Function/Bytes.js")).default(t.Info.Total)}.`:!1})),a==="Image"&&(f=c(f,{Read:async({Input:t})=>{const{format:n}=await S(t).metadata();return S(t,{failOn:"none",sequentialRead:!0,unlimited:!0,animated:n==="webp"||n==="gif"})}}));for(const t of p)await(await(await(await new(await import("files-pipe")).default(s,d).In(t)).By(m[a]??"**/*")).Not(u)).Pipe(f)}}}}}};const{default:l}=await import("../Variable/Option.js"),{default:{Cache:{Search:A}}}=await import("files-pipe/Target/Variable/Option.js"),{default:c}=await import("typescript-esbuild/Target/Function/Merge.js"),{default:S}=await import("sharp");let f;export{l as Default,c as Merge,A as Search,f as _Action,M as default,S as sharp};
